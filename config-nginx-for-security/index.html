<!DOCTYPE html>
<html>
  
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">

    <title>Config Nginx For Security</title>

    
    
    <meta name="description" content="When I was in the security group, we found many programmers don’t know how to handle, or don’t have the awareness of Nginx’s security. We found many exploitations or cases of sensitive data was...">
    <link rel="canonical" href="http://coderscat.com/config-nginx-for-security/" />
    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Config Nginx For Security">
    <meta property="og:description" content="When I was in the security group, we found many programmers don’t know how to handle, or don’t have the awareness of Nginx’s security. We found many exploitations or cases of sensitive data was...">
    <meta property="og:url" content="http://coderscat.com/config-nginx-for-security/" />
    <meta property="og:site_name" content="Coder's Cat">
    <meta property="article:publisher" content="https://www.facebook.com/coderscat">
    <meta property="article:tag" content="">
    <meta property="article:section" content="">
    <meta property="article:published_time" content="2020-11-16 22:52:00">
    <meta property="article:modified_time" content="2020-11-16 22:52:00">
    <meta property="og:updated_time" content="2020-11-16 22:52:00">
    <meta property="og:image" content="http://coderscat.com/images/1638974.png"/>
    <meta property="og:image:secure_url" content="http://coderscat.com/images/1638974.png"/>
    <meta property="og:image:width" content="600">
    <meta property="og:image:height" content="400">
    <meta property="og:image:alt" content="CodersCat">
    <meta property="og:image:type" content="image/jpeg">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Config Nginx For Security">
    <meta name="twitter:description" content="When I was in the security group, we found many programmers don’t know how to handle, or don’t have the awareness of Nginx’s security. We found many exploitations or cases of sensitive data was...">
    <meta name="twitter:site" content="@coderscat">
    <meta name="twitter:creator" content="@coderscat">
    <meta name="twitter:image" content="http://coderscat.com/images/1638974.png"/>



    <link rel="icon" type="image/png" sizes="32x32" href="/css/images/favicon-32x32.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="/css/images/favicon-16x16.ico">

    <title>
        
            Config Nginx For Security | Coder&#39;s Cat
        
    </title>  
    
    
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/plugins/fonts.css">

    
<link rel="stylesheet" href="/css/plugins/code.css">

    
<link rel="stylesheet" href="/css/plugins/nprogress.min.css">

    <link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">


    
<script src="/js/jquery.min.js"></script>

  <script type="text/javascript" src="/js/geopattern.min.js"></script>
  <script type="text/javascript" src="/js/nprogress.min.js"></script>


  <script type="text/javascript" async src="https://platform-api.sharethis.com/js/sharethis.js#property=5fa8f493be36290012aa2a0d&product=inline-share-buttons"></script>

  <div style='margin:0 auto;width:0px;height:0px;overflow:hidden;'>
      <img src="/css/images/logo.png" width='400px' height='400px'/>
  </div>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-77282254-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-77282254-2');
</script>

<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Coder's Cat" type="application/atom+xml">
</head>

  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <div class="logo"></div>
      <span>Coder's Cat</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">Home</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/data-structures/" class="item-link">D&S</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/algorithms/" class="item-link">Algo</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/programming-languages/" class="item-link">PL</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/system/" class="item-link">System</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/tools/" class="item-link">Tools</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/tags/" class="item-link">Tags</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/archives/" class="item-link">Archives</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/about/" class="item-link">About</a>
          
        </li>
      
      <li class="list-item" style="margin: 0">
       <a class="icon-small" href="/search">
        <span class="fa-stack fa-lg">
          <i class="fa fa-search fa-stack-1x fa-inverse" style="color:pink"></i>
        </span>
       </a>
      </li>

      <li class="list-item" style="margin: 0">
        <a class="icon-small" href="/atom.xml">
         <span class="fa-stack fa-lg">
           <i class="fa fa-rss fa-inverse" style="color:orange"></i>
         </span>
        </a>
       </li>
    </ul>
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">Home</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/data-structures/" class="menu-link">D&S</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/algorithms/" class="menu-link">Algo</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/programming-languages/" class="menu-link">PL</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/system/" class="menu-link">System</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/tools/" class="menu-link">Tools</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/tags/" class="menu-link">Tags</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/archives/" class="menu-link">Archives</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/about/" class="menu-link">About</a>
            
          </li>
        


        <li class="list-item" style="margin: 0">
          <a class="icon-small" href="/search">
           <span class="fa-stack">
             <i class="fa fa-search"></i>
           </span>
          </a>
         </li>

         
      <li class="list-item" style="margin: 0">
        <a class="icon-small" href="/atom.xml">
         <span class="fa-stack fa-lg">
           <i id="rss-icon" class="fa fa-rss fa-inverse"></i>
         </span>
        </a>
       </li>

      </ul>
    </div>
  </div>
</header>

    <div id="article-banner">
  <h2>Config Nginx For Security</h2>
  <p class="post-date">2020-11-16</p>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>
<main class="app-body flex-box">
  <!-- Article START -->
  <article class="post-article">
    <section class="markdown-content">
      <p>When I was in the security group, we found many programmers don’t know how to handle, or don’t have the awareness of Nginx’s security. We found many exploitations or cases of sensitive data was pulled from web servers by attackers.</p>
<p>Here I will list some configurations for Nginx’s Security. Please do adjustments to these configurations according to your actual requirements.</p>
<p><img src="/images/1638974.png" alt="Nginx Logo - LogoDix"></p>
<h2 id="Forbidden-any-sensitive-request-path"><a href="#Forbidden-any-sensitive-request-path" class="headerlink" title="Forbidden any sensitive request path"></a>Forbidden any sensitive request path</h2><p>Many source codes are using Git as version control tools. The directory <code>.git</code> will contains all the metadata of codebase, including some secrets, etc. Expose it to the public will make your codebase downable for attackers:</p>
<img src="/images/image-20201116125232230.png" width="50%">

<p>So we need to disable the <code>.git</code> related request routes.</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">location</span> <span class="hljs-regexp">~ /\.git</span> &#123;<br>  <span class="hljs-attribute">deny</span> all;<br>&#125;<br><span class="hljs-comment">## Disable .htaccess and other hidden files</span><br><span class="hljs-attribute">location</span> <span class="hljs-regexp">~ /\.(?!well-known).*</span> &#123;<br>    <span class="hljs-attribute">deny</span> all;<br>    <span class="hljs-attribute">access_log</span> <span class="hljs-literal">off</span>;<br>    <span class="hljs-attribute">log_not_found</span> <span class="hljs-literal">off</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="Forbidden-unnecessary-HTTP-request-methods"><a href="#Forbidden-unnecessary-HTTP-request-methods" class="headerlink" title="Forbidden unnecessary HTTP request methods"></a>Forbidden unnecessary HTTP request methods</h2><p>The most commonly used HTTP request methods are GET, POST, HEAD. We should return 444 for any other unused methods.</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><code class="hljs nginx"><span class="hljs-comment">## Only allow these request methods ##</span><br><span class="hljs-attribute">if</span> (<span class="hljs-variable">$request_method</span> !<span class="hljs-regexp">~ ^(GET|HEAD|POST)$</span> ) &#123;<br>         <span class="hljs-attribute">return</span> <span class="hljs-number">444</span>;<br>&#125;<br><span class="hljs-comment">## Do not accept DELETE, SEARCH, and other methods ##</span><br></code></pre></td></tr></table></figure>

<h2 id="Add-request-rate-limiting"><a href="#Add-request-rate-limiting" class="headerlink" title="Add request rate limiting"></a>Add request rate limiting</h2><p><a target="_blank" rel="noopener" href="https://www.nginx.com/blog/rate-limiting-nginx/">Rate limiting</a> will block many malicious requests, and it is also a frequently used tool to defend against network and application-level <strong>DDoS attacks</strong> against websites.</p>
<p>We can add the maximum request limit for a single IP.</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">limit_req_zone</span> <span class="hljs-variable">$binary_remote_addr</span> zone=ip:<span class="hljs-number">10m</span> rate=5r/s;<br><br><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;<br>    <span class="hljs-attribute">location</span> / &#123;<br>        <span class="hljs-attribute">limit_req</span> zone=ip burst=<span class="hljs-number">12</span> delay=<span class="hljs-number">8</span>;<br>        <span class="hljs-attribute">proxy_pass</span> http://website;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="Add-HTTPS-for-your-service"><a href="#Add-HTTPS-for-your-service" class="headerlink" title="Add HTTPS for your service"></a>Add HTTPS for your service</h2><p>If you are deploying a non-company project,  <a target="_blank" rel="noopener" href="https://letsencrypt.org/">Let’s encrypt</a> will be enough for personal usage. And remember to redirect all non-HTTPS requests to HTTPS with 301. </p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span>               <span class="hljs-number">80</span>;<br>    <span class="hljs-attribute">listen</span>               <span class="hljs-number">443</span> ssl;<br>    <span class="hljs-attribute">server_name</span>          www.coderscat.com;<br>    <span class="hljs-attribute">ssl_certificate</span>      /etc/letsencrypt/live/coderscat.com/fullchain.pem;<br>    <span class="hljs-attribute">ssl_certificate_key</span>  /etc/letsencrypt/live/coderscat.com/privkey.pem;<br>    <span class="hljs-attribute">return</span> <span class="hljs-number">301</span> https://coderscat.com<span class="hljs-variable">$request_uri</span>;<br>&#125;<br><br><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;<br>    <span class="hljs-attribute">listen</span> <span class="hljs-number">443</span> ssl http2;<br>    <span class="hljs-attribute">server_name</span> coderscat.com;<br><br>    <span class="hljs-comment"># ssl on;</span><br>    <span class="hljs-attribute">ssl_certificate</span>       /etc/letsencrypt/live/coderscat.com/fullchain.pem;<br>    <span class="hljs-attribute">ssl_certificate_key</span>  /etc/letsencrypt/live/coderscat.com/privkey.pem;<br><br>    <span class="hljs-attribute">ssl_protocols</span>        TLSv1 TLSv1.<span class="hljs-number">1</span> TLSv1.<span class="hljs-number">2</span>;<br>    <span class="hljs-attribute">ssl_ciphers</span>          ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;<br>    <span class="hljs-attribute">ssl_prefer_server_ciphers</span>  <span class="hljs-literal">on</span>;<br>    <span class="hljs-attribute">ssl_session_cache</span>    shared:SSL:<span class="hljs-number">10m</span>;<br>    <span class="hljs-attribute">ssl_session_timeout</span>  <span class="hljs-number">10m</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="Enable-SELinux"><a href="#Enable-SELinux" class="headerlink" title="Enable SELinux"></a>Enable SELinux</h2><p><code>SELiunux</code> stands for Security-Enhanced Linux, it is a Linux kernel security module that provides a mechanism for supporting access control security policies, including mandatory access controls (MAC).  It can prevent several attacks before your system being hacked.</p>
<p>Install it on Ubuntu: </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> sudo apt install policycoreutils selinux-utils selinux-basics</span><br><span class="hljs-meta">$</span><span class="bash"> sudo selinux-activate</span><br><span class="hljs-meta">$</span><span class="bash"> sudo selinux-config-enforcing  (Then reboot system)</span><br><span class="hljs-meta">$</span><span class="bash"> sudo sestatus (query the status of SELinux)</span><br></code></pre></td></tr></table></figure>

<h3 id="Clickjacking-Attack"><a href="#Clickjacking-Attack" class="headerlink" title="Clickjacking Attack"></a>Clickjacking Attack</h3><p><a target="_blank" rel="noopener" href="https://www.imperva.com/learn/application-security/clickjacking/">Clickjacking attack</a>  will cause users to unwittingly download malware, visit malicious web pages, provide credentials or sensitive information.</p>
<p>We can inject <code>X-FRAME-OPTIONS</code> in HTTP Header to prevent a clickjacking attack(Even this can be bypassed in some ways). This is achieved by adding below in <code>nginx.conf</code> file</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">add_header</span> X-Frame-Options <span class="hljs-string">&quot;SAMEORIGIN&quot;</span>;<br></code></pre></td></tr></table></figure>

<p>Above header will instruct a browser to load the resources ONLY from the same origin.</p>
<h3 id="X-XSS-Protection"><a href="#X-XSS-Protection" class="headerlink" title="X-XSS Protection"></a>X-XSS Protection</h3><p>Inject HTTP Header with X-XSS protection to mitigate Cross-Site scripting attack. Modify <code>nginx.conf</code> file to add the following</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">add_header</span> X-XSS-Protection <span class="hljs-string">&quot;1; mode=block&quot;</span>;<br></code></pre></td></tr></table></figure>

<p>Save the configuration file and restart Nginx. You can use the <a target="_blank" rel="noopener" href="https://gf.dev/http-headers-test">Headers Test</a> tool to verify after implementation.</p>
<p>You may also be interested in implementing OWASP recommended secure headers which are explained <a target="_blank" rel="noopener" href="https://geekflare.com/http-header-implementation/">here</a>.</p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p><a target="_blank" rel="noopener" href="https://amzn.to/3f21Uwd">Mastering NGINX Second Edition</a> is an excellent reference book for the introduction of Nginx.</p>

    </section>

     <div>
          <p style="text-align:center; color: #12472d; margin-left: 2%; margin-right: 2%;"><b>Join my <a target="_blank" rel="noopener" href="http://codercat.substack.com">Email List</a> for more insights, It's Free!&#128523;	</b></p>
          <iframe src="https://codercat.substack.com/embed" width="96%" height="350" style="border:2px solid #EEE; background:rgb(248, 244, 244); margin-left: 2%; margin-right: 2%;" frameborder="1" scrolling="no"></iframe>
      </div>
    
    <!-- Tags START -->
    
      <div class="tags">
        <span>Tags:</span>
        
  <a href="/tags#Programming" >
    <span class="tag-code-index">Programming</span>
  </a>


      </div>
    

    <div class="sharethis-inline-share-buttons"></div>

    <!-- Tags END -->
    <!-- NAV START -->
    
  <div class="nav-container">
    <!-- reverse left and right to put prev and next in a more logic postition -->
    
      <a class="nav-left" href="/awesome-books-for-python-programming/">
        <span class="nav-arrow">← </span>
        
          Top 5 Books for Python Programming
        
      </a>
    
    
        <a class="nav-right" href="/tools-for-programming-languages/">
            
                The Tools For Programming Langua...
        
        <span class="nav-arrow"> →</span>
      </a>
    
  </div>


    <!-- NAV END -->

    <script src="https://utteranc.es/client.js"
            repo="nickmose8/coderscat-comments"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
    </script>

  </article>
  <!-- Article END -->
  <!-- Catalog START -->
  
      <aside class="catalog-container">
  <div class="toc-main">
    <strong class="toc-title"></strong>
    
      <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Forbidden-any-sensitive-request-path"><span class="toc-nav-text">Forbidden any sensitive request path</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Forbidden-unnecessary-HTTP-request-methods"><span class="toc-nav-text">Forbidden unnecessary HTTP request methods</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Add-request-rate-limiting"><span class="toc-nav-text">Add request rate limiting</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Add-HTTPS-for-your-service"><span class="toc-nav-text">Add HTTPS for your service</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Enable-SELinux"><span class="toc-nav-text">Enable SELinux</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Clickjacking-Attack"><span class="toc-nav-text">Clickjacking Attack</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#X-XSS-Protection"><span class="toc-nav-text">X-XSS Protection</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#References"><span class="toc-nav-text">References</span></a></li></ol>
    
  </div>
</aside>

  
  <!-- Catalog END -->

</main>




<script>
  (function () {
    var url = 'http://coderscat.com/config-nginx-for-security/';
    var banner = ''
    if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url)
    }
    $('.header').removeClass('fixed-header')

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      if (src !== 'http://file.muyutech.com/error-img.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()

        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function() {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })

  })();
</script>

    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer" id="footer">
    <p class="copyright">
        &copy; 2022 | CodersCat
  </p>
</footer>

<script>
  function async(u, c) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
</script>
<script>
  async("//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
    FastClick.attach(document.body);
  })
</script>

<script>
 var hasLine = 'false';
 async("//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js", function(){
     $('figure pre').each(function(i, block) {
         var figure = $(this).parents('figure');
         if (hasLine === 'false') {
             figure.find('.gutter').hide();
         }
         var lang = figure.attr('class').split(' ')[1] || 'code';
         var codeHtml = $(this).html();
         var codeTag = document.createElement('code');
         codeTag.className = lang;
         codeTag.innerHTML = codeHtml;
         $(this).attr('class', '').empty().html(codeTag);
         figure.attr('data-lang', lang.toUpperCase());
     });
 })
</script>

<script src="/js/script.js"></script>


  </body>
</html>